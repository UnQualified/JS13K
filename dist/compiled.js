function game(){function e(){if(t(),i(),o.fillStyle="black","menu"!==g.state?(l(g.state,s.width-200,20,"left"),l("player 1: "+g.playerOneHealth,10,s.height-50),l("player 2: "+g.playerTwoHealth,s.width-200,s.height-50)):(l("GAME TITLE",c.x,c.y-50,"center","52px"),l("press [space] to start",c.x,c.y+20,"center"),g.start&&(g.state="toss")),"toss"===g.state)if(f.getScore()<v&&u.getScore()<v)f.draw(o),u.draw(o);else{var a="";120>p?(p++,a=f.getScore()>=v?"player one":"player two",g.tossWinner=f.getScore()>=v?1:2,a+=" has the power"):240>p?(a="choose your attack",p++):a=null,null!==a?l(a,c.x,c.y,"center"):g.state="attackSelection"}else if("attackSelection"==g.state)k.displayAttacks(c),r();else if("attack"==g.state){var n="player "+g.tossWinner+" does a "+g.chosenAttack.type+" attack";l(n,c.x,c.y,"center"),p++,p>=120&&r({state:"defense"})}else if("defense"==g.state)g.defender=1===g.tossWinner?2:1,l("player "+g.defender+", reverse it!!",c.x,c.y,"center"),p++,p>=120&&r({state:"attackIncoming"});else if("attackIncoming"==g.state){p++;var y=60/g.chosenAttack.speed*10;switch(l(y+" : "+p,c.x,s.height-50,"center"),g.defender){case 1:f.getScore()>=100&&(g.state="attackFail");break;case 2:u.getScore()>=100&&(g.state="attackFail")}p>=y&&(g.state="attackSuccess")}else if("attackFail"==g.state)r(),1===g.defender?(g.playerTwoHealth-=g.chosenAttack.damage/2,g.playerTwoHealth<=0?(g.playerTwoHealth=0,r({state:"gameOver"})):g.state="toss"):(g.playerOneHealth-=g.chosenAttack.damage/2,g.playerOneHealth<=0?(g.playerOneHealth=0,g.state="gameOver"):g.state="toss");else if("attackSuccess"==g.state){var h=!0;1===g.defender?(g.playerOneHealth-=g.chosenAttack.damage,g.playerOneHealth<=0&&(g.playerOneHealth=0,g.state="gameOver",p=0,h=!1)):(g.playerTwoHealth-=g.chosenAttack.damage,g.playerTwoHealth<=0&&(g.playerTwoHealth=0,g.state="gameOver",p=0,h=!1)),h&&r({state:"toss"})}else if("gameOver"==g.state){var d=g.playerOneHealth<=0?"Player 2":"Player 1";d+=" wins",l(d,c.x,c.y,"center"),p++,p>=120&&(g.start=!1,r({state:"menu",health:!0}))}window.requestAnimationFrame(e)}function t(){o.clearRect(0,0,s.width,s.height)}function a(e,t,a){var n=0;return{draw:function(){o.fillStyle="rgba(240,240,240,0.75)",l(a.getLetter(),e,t,"center","400px"),o.fillStyle="rgb(255,255,255)"},getScore:function(){return n},updateScore:function(e){n+=e},resetScore:function(){n=0}}}function n(){return{x:s.width/2,y:s.height/2}}function r(e){p=0,f.resetScore(),u.resetScore(),void 0!==e&&(void 0!==e.health&&(g.playerOneHealth=g.playerTwoHealth=T),void 0!==e.state&&(g.state=e.state))}function l(e,t,a,n,r){void 0!==n&&(o.textAlign=n),o.font=(void 0===r?"22px":r)+" sans-serif",o.fillText(e,t,a)}function i(){backgroundOne(o),backgroundTwo(o),sun(o)}var s=document.getElementById("canvas"),o=s.getContext("2d");s.width=960,s.height=540;var c=n(),y=new AvailableKeys,h=new KeyStroke(y.getKey()),d=new KeyStroke(y.getKey()),f=a(240,s.height/2+100,h),u=a(720,s.height/2+100,d),k=new Attack(o),p=0,g={state:"menu",attackingPlayer:null,playerOneHealth:100,playerTwoHealth:100,tossWinner:null,chosenAttack:null,defender:null,start:!1},T=100,v=50,w={water:{type:"water",speed:2,damage:30},fire:{type:"fire",speed:1,damage:40},electric:{type:"electric",speed:3,damage:15},special:{type:"special",speed:2,damage:50}};window.requestAnimationFrame(e),window.addEventListener("keydown",function(e){if("menu"===g.state)32===e.keyCode&&(g.start=!0);else if("toss"===g.state)e.keyCode===h.currentLetter?(y.keys[h.currentLetter-65].available=!0,h.assignLetter(y.getKey()),f.updateScore(10)):e.keyCode===d.currentLetter&&(y.keys[d.currentLetter-65].avaialble=!0,d.assignLetter(y.getKey()),u.updateScore(10));else if("attackIncoming"===g.state)e.keyCode===h.currentLetter?(y.keys[h.currentLetter-65].available=!0,h.assignLetter(y.getKey()),f.updateScore(20)):e.keyCode===d.currentLetter&&(y.keys[d.currentLetter-65].available=!0,d.assignLetter(y.getKey()),u.updateScore(20));else if("attackSelection"===g.state&&k.available)switch(e.keyCode){case 87:k.available=!1,g.state="attack",g.chosenAttack=w.water;break;case 70:k.available=!1,g.state="attack",g.chosenAttack=w.fire;break;case 69:k.available=!1,g.state="attack",g.chosenAttack=w.electric;break;case 83:k.available=!1,g.state="attack",g.chosenAttack=w.special}})}function backgroundOne(e){e.fillStyle="rgb(225,225,225)";var t=new Path2D;t.moveTo(0,200),t.lineTo(175,150),t.lineTo(225,175),t.lineTo(300,215),t.lineTo(350,195),t.lineTo(400,135),t.lineTo(425,120),t.lineTo(429,175),t.lineTo(500,230),t.lineTo(600,275),t.lineTo(650,200),t.lineTo(675,170),t.lineTo(700,190),t.lineTo(810,166),t.lineTo(850,150),t.lineTo(900,170),t.lineTo(960,165),t.lineTo(960,540),t.lineTo(0,540),e.fill(t)}function backgroundTwo(e){e.fillStyle="rgb(200,200,200)";var t=new Path2D;t.moveTo(0,180),t.lineTo(100,300),t.lineTo(225,350),t.lineTo(350,375),t.lineTo(400,310),t.lineTo(460,225),t.lineTo(575,185),t.lineTo(645,237),t.lineTo(760,270),t.lineTo(820,312),t.lineTo(960,250),t.lineTo(960,540),t.lineTo(0,540),e.fill(t)}function sun(e){e.fillStyle="rgb(230,230,230)",e.beginPath(),e.arc(800,50,40,0,2*Math.PI,!0),e.closePath(),e.fill()}function rnd(e,t){return Math.floor(Math.random()*(t-e+1))+e}function KeyStroke(e){this.currentLetter=e}function AvailableKeys(){this.keys=[];for(var e=65;91>e;e++)this.keys.push({key:e,available:!0})}function Attack(e){this.ctx=e,this.available=!1}KeyStroke.prototype.assignLetter=function(e){this.currentLetter=e},KeyStroke.prototype.getLetter=function(){return String.fromCharCode(this.currentLetter).toUpperCase()},KeyStroke.prototype.getRandom=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},AvailableKeys.prototype.getKey=function(){var e=rnd(0,this.keys.length-1),t=this.keys[e];return t.available?(this.keys[e].available=!1,t.key):this.getKey()},Attack.prototype.displayAttacks=function(e){this.available=!0,this.ctx.fillText("fire",e.x-100,e.y),this.ctx.fillText("water",e.x,e.y-100),this.ctx.fillText("electric",e.x+100,e.y),this.ctx.fillText("special",e.x,e.y+100)},Attack.prototype.selectedAttack=function(e){this.available&&(this.ctx.textAlign="left",this.ctx.fillText(e+" selected",20,100))};